<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Админ‑панель</title>
<style>
    body {
        font-family: 'Segoe UI', sans-serif;
        background: #181818; margin: 0; padding: 0; color: #f5f5f5;
    }
    header {
        background: #202020;
        border-bottom: 2px solid #ff4242;
        padding: 20px 40px;
        display: flex; justify-content: space-between; align-items: center;
    }
    header h1 { margin: 0; font-size: 26px; color: #ff4242; }
    .repo-btn, .btn {
        background: #ff4242; border: none; padding: 10px 18px;
        border-radius: 5px; color: white; font-weight: bold;
        cursor: pointer; transition: 0.2s;
    }
    .repo-btn:hover, .btn:hover { background: #e63838; }
    .main-container {
        display: flex; justify-content: space-between; align-items: flex-start;
        padding: 30px 40px; gap: 20px;
    }
    .card {
        background: #202020; padding: 20px; border-radius: 8px; flex: 1;
        box-shadow: 0 0 8px rgba(255,66,66,0.15);
    }
    .card h3 { color: #ff4242; margin-top: 0; }
    input, textarea, select {
        width: 100%; margin: 6px 0 14px; padding: 10px;
        border-radius: 5px; border: none; outline: none;
        background: #2a2a2a; color: #f5f5f5; font-size: 14px;
    }
    pre {
        background: #2a2a2a; padding: 15px; border-radius: 6px;
        color: #a8ff60; font-size: 13px; max-height: 400px; overflow-y: auto;
    }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; background: #202020; }
    th, td { padding: 14px; text-align: center; }
    th { background: #2c2c2c; color: #ff4242; font-weight: bold; }
    tr:nth-child(even) { background: #242424; }
    tr:hover { background: #333; }
    .action-btn {
        padding: 6px 12px; border: none; border-radius: 4px;
        cursor: pointer; font-size: 13px; margin: 0 3px;
    }
    .delete-btn { background: #c0392b; color: white; }
    .delete-btn:hover { background: #e74c3c; }
    .preview-btn { background: #2980b9; color: white; }
    .preview-btn:hover { background: #3498db; }
    /* --- Модалка --- */
    .modal {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.65); display: flex; justify-content: center; align-items: center;
        opacity: 0; pointer-events: none; transition: opacity 0.3s ease; z-index: 1000;
    }
    .modal.active { opacity: 1; pointer-events: auto; }
    .modal-card { width: 420px; max-width: 95%; position: relative; transform: scale(0.8); transition: 0.3s; }
    .modal.active .modal-card { transform: scale(1); }
    .close-btn { position: absolute; top: -10px; right: -10px; background: #ff4242;
                 border: none; font-size: 18px; color: #fff; border-radius: 50%; width: 30px; height: 30px; cursor: pointer;}
    /* --- Карточка предпросмотра --- */
    .preview-card { background: #202020; border-radius: 10px; overflow: hidden; }
    .preview-card img { width: 100%; height: 200px; object-fit: cover; }
    .preview-body { padding: 15px; }
    .preview-body h3 { margin: 0 0 8px; font-size: 20px; color: #fff; font-weight: bold; }
    .preview-body p { margin: 0 0 10px; color: #ccc; }
    .tag { display: inline-block; background: #2c2c2c; color: #ff4242;
           border-radius: 15px; padding: 4px 10px; margin: 3px 6px 3px 0; font-size: 12px; }
    .play-btn { display: inline-block; margin-top: 10px; color: #ff4242; font-weight: bold; text-decoration: none; }
    .play-btn:hover { color: #fff; text-shadow: 0 0 8px #ff4242; }
</style>
</head>
<body>

<header>
    <h1>Админ‑панель</h1>
    <div>
      <button class="repo-btn" onclick="loadFromGitHub()">Загрузить из GitHub</button>
      <button class="repo-btn" onclick="saveToGitHub()">Сохранить на GitHub</button>
    </div>
</header>

<div class="main-container">
    <div class="card">
        <h3>Добавить проект</h3>
        <input id="title" placeholder="Заголовок">
        <input id="url" placeholder="URL картинки">
        <input id="tags" placeholder="Теги (через запятую)">
        <input id="link" placeholder="Ссылка (Играть)">
        <select id="access">
            <option value="public">Для всех</option>
            <option value="secret">Секретный</option>
        </select>
        <textarea id="desc" placeholder="Описание"></textarea>
        <button class="btn" onclick="addProject()">Добавить</button>
    </div>
    <div class="card">
        <h3>JSON</h3>
        <pre id="jsonOutput">[]</pre>
        <button class="btn" onclick="downloadJSON()">Скачать JSON</button>
    </div>
</div>

<div class="card" style="margin:20px 40px;">
    <h3>Текущие проекты</h3>
    <table id="projectsTable">
        <tr><th>Название</th><th>Доступ</th><th>Теги</th><th>Действие</th></tr>
    </table>
</div>

<!-- Модалка -->
<div id="previewModal" class="modal">
  <div class="modal-card">
    <button class="close-btn" onclick="closePreview()">✖</button>
    <div id="previewContent"></div>
  </div>
</div>

<script>
    let projects = [];
    let fileSha = null;

    // ⚠️ Настройки GitHub
    const githubRepo = "FresenBer4ik/FresenBer4ik.github.io";   // например "FresenBer4ik/cosmos"
    const githubBranch = "main";
    const githubFile = "projects.json";
    const githubToken = "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"; // ⚠️ сюда вставь Personal Access Token

    // --- загрузка из GitHub ---
    async function loadFromGitHub() {
        const url = `https://api.github.com/repos/${githubRepo}/contents/${githubFile}?ref=${githubBranch}`;
        const res = await fetch(url, {
            headers: { "Authorization": "token " + githubToken }
        });
        const data = await res.json();
        const content = atob(data.content);
        projects = JSON.parse(content);
        fileSha = data.sha;
        renderProjects(); updateJSON();
        alert("Загружено с GitHub");
    }

    // --- сохранение в GitHub ---
    async function saveToGitHub() {
        const url = `https://api.github.com/repos/${githubRepo}/contents/${githubFile}`;
        const contentBase64 = btoa(unescape(encodeURIComponent(JSON.stringify(projects, null, 2))));
        const body = {
            message: "update projects.json",
            content: contentBase64,
            sha: fileSha,
            branch: githubBranch
        };
        const res = await fetch(url, {
            method: "PUT",
            headers: {
                "Authorization": "token " + githubToken,
                "Content-Type": "application/json"
            },
            body: JSON.stringify(body)
        });
        if (res.ok) {
            const result = await res.json();
            fileSha = result.content.sha;
            alert("Успешно сохранено в GitHub!");
        } else {
            alert("Ошибка сохранения");
            console.error(await res.json());
        }
    }

    // --- локальные функции ---
    function addProject() {
        let project = {
          title: title.value,
          url: url.value,
          tags: tags.value.split(',').map(t => t.trim()).filter(Boolean),
          link: link.value,
          access: access.value,
          desc: desc.value
        };
        projects.push(project);
        renderProjects(); updateJSON();
        title.value = url.value = tags.value = link.value = desc.value = "";
    }

    function renderProjects() {
        const table = document.getElementById("projectsTable");
        table.innerHTML = `<tr><th>Название</th><th>Доступ</th><th>Теги</th><th>Действие</th></tr>`;
        projects.forEach((p,i)=>{
            let row = table.insertRow();
            row.insertCell(0).innerText = p.title;
            row.insertCell(1).innerText = p.access;
            row.insertCell(2).innerText = (p.tags||[]).join(", ");
            let act = row.insertCell(3);
            let prev = document.createElement("button");
            prev.innerText = "Предпросмотр"; prev.className="action-btn preview-btn";
            prev.onclick = ()=>openPreview(p);
            let del = document.createElement("button");
            del.innerText = "Удалить"; del.className="action-btn delete-btn";
            del.onclick = ()=>{ projects.splice(i,1); renderProjects(); updateJSON(); };
            act.appendChild(prev); act.appendChild(del);
        });
    }

    function updateJSON() {
        document.getElementById("jsonOutput").textContent = JSON.stringify(projects, null, 4);
    }

    function downloadJSON() {
        let data = JSON.stringify(projects, null, 4);
        let blob = new Blob([data], {type:"application/json"});
        let url = URL.createObjectURL(blob);
        let a = document.createElement("a");
        a.href=url; a.download="projects.json"; a.click();
        URL.revokeObjectURL(url);
    }

    function openPreview(p) {
        const tagsHtml = (p.tags||[]).map(tag=>`<span class="tag">${tag}</span>`).join(" ");
        previewContent.innerHTML = `
          <div class="preview-card">
            <img src="${p.url||'https://via.placeholder.com/400x200'}">
            <div class="preview-body">
                <h3>${p.title}</h3>
                <p>${p.desc||""}</p>
                <div>${tagsHtml}</div>
                ${p.link?`<a href="${p.link}" target="_blank" class="play-btn">Играть ➡️</a>`:""}
            </div>
          </div>`;
        previewModal.classList.add("active");
    }
    function closePreview(){ previewModal.classList.remove("active"); }
</script>

</body>
</html>
